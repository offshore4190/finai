# HTMLå›¾ç‰‡é“¾æ¥é‡å†™æµ‹è¯•æŒ‡å—

## ğŸ“‹ æµ‹è¯•ç›®çš„

éªŒè¯ä¸‹è½½çš„HTMLæ–‡ä»¶ä¸­çš„æ‰€æœ‰ `<img>` æ ‡ç­¾çš„ `src` å±æ€§æ˜¯å¦å·²ç»ä»åŸå§‹çš„ SEC URLï¼ˆå¦‚ `https://www.sec.gov/...`ï¼‰é‡å†™ä¸ºæœ¬åœ°ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚ `./image01.png`ï¼‰ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åŸºç¡€æµ‹è¯•

```bash
cd /Users/hao/Desktop/FINAI/files/filings-etl

# æµ‹è¯•æ‰€æœ‰HTMLæ–‡ä»¶ï¼ˆå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼‰
python test_html_image_rewrite.py
```

### 2. æŠ½æ ·æµ‹è¯•ï¼ˆæ¨èï¼‰

```bash
# éšæœºæŠ½æ ·50ä¸ªæ–‡ä»¶å¿«é€Ÿæµ‹è¯•
python test_html_image_rewrite.py --sample 50

# æŠ½æ ·100ä¸ªæ–‡ä»¶
python test_html_image_rewrite.py --sample 100
```

### 3. æŒ‰äº¤æ˜“æ‰€æµ‹è¯•

```bash
# åªæµ‹è¯•NASDAQ
python test_html_image_rewrite.py --exchange NASDAQ

# åªæµ‹è¯•NYSE
python test_html_image_rewrite.py --exchange NYSE
```

### 4. æµ‹è¯•ç‰¹å®šå…¬å¸

```bash
# æµ‹è¯•è‹¹æœå…¬å¸çš„æ–‡ä»¶
python test_html_image_rewrite.py --company AAPL

# æµ‹è¯•ç‰¹æ–¯æ‹‰å…¬å¸çš„æ–‡ä»¶
python test_html_image_rewrite.py --company TSLA
```

### 5. è¯¦ç»†æ¨¡å¼

```bash
# æ˜¾ç¤ºæ¯ä¸ªæ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯
python test_html_image_rewrite.py --sample 10 --verbose
```

## ğŸ“Š æµ‹è¯•æŠ¥å‘Šè§£è¯»

### æˆåŠŸç¤ºä¾‹

```
ğŸ“Š æµ‹è¯•æŠ¥å‘Š
================================================================================

ã€æ€»ä½“ç»Ÿè®¡ã€‘
  æµ‹è¯•æ–‡ä»¶æ•°: 50
  åŒ…å«å›¾ç‰‡çš„æ–‡ä»¶: 45
  å›¾ç‰‡æ ‡ç­¾æ€»æ•°: 823
  å·²æ­£ç¡®é‡å†™: 823
  æœªé‡å†™ï¼ˆä»æ˜¯SEC URLï¼‰: 0
  å¤„ç†é”™è¯¯: 0

  âœ¨ é‡å†™ç‡: 100.00%

--------------------------------------------------------------------------------

âœ… æ‰€æœ‰HTMLæ–‡ä»¶çš„å›¾ç‰‡é“¾æ¥éƒ½å·²æ­£ç¡®é‡å†™ä¸ºæœ¬åœ°ç›¸å¯¹è·¯å¾„ï¼

================================================================================
ğŸ‰ æµ‹è¯•é€šè¿‡ï¼æ‰€æœ‰å›¾ç‰‡é“¾æ¥éƒ½å·²æ­£ç¡®é‡å†™ã€‚
================================================================================
```

### å¤±è´¥ç¤ºä¾‹

```
ğŸ“Š æµ‹è¯•æŠ¥å‘Š
================================================================================

ã€æ€»ä½“ç»Ÿè®¡ã€‘
  æµ‹è¯•æ–‡ä»¶æ•°: 50
  åŒ…å«å›¾ç‰‡çš„æ–‡ä»¶: 45
  å›¾ç‰‡æ ‡ç­¾æ€»æ•°: 823
  å·²æ­£ç¡®é‡å†™: 750
  æœªé‡å†™ï¼ˆä»æ˜¯SEC URLï¼‰: 73
  å¤„ç†é”™è¯¯: 0

  âœ¨ é‡å†™ç‡: 91.13%

--------------------------------------------------------------------------------

âš ï¸  å‘ç° 8 ä¸ªæ–‡ä»¶å­˜åœ¨æœªé‡å†™çš„å›¾ç‰‡é“¾æ¥

ã€é—®é¢˜æ–‡ä»¶åˆ—è¡¨ã€‘ï¼ˆå‰20ä¸ªï¼‰

1. æ–‡ä»¶: NASDAQ/AAPL/2023/0000320193-23-000077/aapl-20230930.htm
   å›¾ç‰‡æ€»æ•°: 15, æœªé‡å†™: 5
   æœªé‡å†™çš„URLç¤ºä¾‹:
     - https://www.sec.gov/Archives/edgar/data/320193/000032019323000077/aapl-20230930_g1.jpg
     - https://www.sec.gov/Archives/edgar/data/320193/000032019323000077/aapl-20230930_g2.jpg

================================================================================
âŒ æµ‹è¯•å¤±è´¥ï¼šå‘ç° 73 ä¸ªæœªé‡å†™çš„å›¾ç‰‡é“¾æ¥ã€‚
================================================================================
```

## ğŸ” æµ‹è¯•é€»è¾‘

### åˆ¤æ–­æ ‡å‡†

è„šæœ¬ä¼šæ£€æŸ¥æ¯ä¸ª `<img>` æ ‡ç­¾çš„ `src` å±æ€§ï¼Œå¹¶åˆ†ç±»ä¸ºï¼š

1. **å·²é‡å†™** âœ…
   - å½¢å¼ï¼š`./image01.png`, `./image02.jpg`, `image01.png`
   - ä¸åŒ…å« `http://` æˆ– `https://`
   - åŒ…å« `image` å…³é”®è¯æˆ–å›¾ç‰‡æ‰©å±•å

2. **æœªé‡å†™** âŒ
   - ä»ç„¶æ˜¯ SEC URLï¼š`https://www.sec.gov/...`
   - åŒ…å« `sec.gov` åŸŸå
   - æˆ–ä»¥ `http://`, `https://` å¼€å¤´

3. **å…¶ä»–æ ¼å¼** â„¹ï¸
   - Data URLï¼š`data:image/png;base64,...`
   - å…¶ä»–ç‰¹æ®Šæ ¼å¼

### æ£€æŸ¥æ–¹æ³•

```python
# ä½¿ç”¨ BeautifulSoup è§£æ HTML
soup = BeautifulSoup(html_content, 'html.parser')
img_tags = soup.find_all('img')

# æ£€æŸ¥æ¯ä¸ª img æ ‡ç­¾çš„ src
for img in img_tags:
    src = img.get('src', '')
    if 'sec.gov' in src or src.startswith('http'):
        # æœªé‡å†™
    elif src.startswith('./') or 'image' in src:
        # å·²é‡å†™
```

## ğŸ“ˆ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šéªŒè¯æ–°ä¸‹è½½çš„æ–‡ä»¶

```bash
# ä¸‹è½½åç«‹å³æµ‹è¯•
python test_html_image_rewrite.py --sample 20 --verbose
```

### åœºæ™¯2ï¼šæ‰¹é‡éªŒè¯

```bash
# æŒ‰äº¤æ˜“æ‰€é€ä¸€éªŒè¯
python test_html_image_rewrite.py --exchange NASDAQ
python test_html_image_rewrite.py --exchange NYSE
python test_html_image_rewrite.py --exchange "NYSE American"
```

### åœºæ™¯3ï¼šé—®é¢˜æ’æŸ¥

```bash
# è¯¦ç»†æ¨¡å¼ï¼ŒæŸ¥çœ‹å…·ä½“é—®é¢˜
python test_html_image_rewrite.py --company AAPL --verbose
```

## ğŸ› ï¸ æŠ€æœ¯ç»†èŠ‚

### ä¾èµ–é¡¹

è„šæœ¬éœ€è¦ `beautifulsoup4` åº“ï¼ˆå·²åŒ…å«åœ¨ `requirements.txt` ä¸­ï¼‰ï¼š

```bash
pip install beautifulsoup4
```

### æ–‡ä»¶æ‰«æè§„åˆ™

- æ‰«æè·¯å¾„ï¼š`{STORAGE_ROOT}/{äº¤æ˜“æ‰€}/{å…¬å¸}/{å¹´ä»½}/**/*.html`
- æ”¯æŒ `.html` å’Œ `.htm` æ‰©å±•å
- é€’å½’æœç´¢æ‰€æœ‰å­ç›®å½•

### æ€§èƒ½è€ƒè™‘

- **å°è§„æ¨¡æµ‹è¯•**ï¼ˆ< 100æ–‡ä»¶ï¼‰ï¼šå‡ ç§’é’Ÿ
- **ä¸­ç­‰è§„æ¨¡**ï¼ˆ100-1000æ–‡ä»¶ï¼‰ï¼š1-2åˆ†é’Ÿ
- **å¤§è§„æ¨¡æµ‹è¯•**ï¼ˆå…¨éƒ¨æ–‡ä»¶ï¼‰ï¼šå¯èƒ½éœ€è¦10-30åˆ†é’Ÿ

å»ºè®®ä½¿ç”¨ `--sample` å‚æ•°è¿›è¡ŒæŠ½æ ·æµ‹è¯•ã€‚

## ğŸ› å¸¸è§é—®é¢˜

### Q1: æ˜¾ç¤º "æ²¡æœ‰æ‰¾åˆ°HTMLæ–‡ä»¶"

**A:** æ£€æŸ¥ï¼š
1. `STORAGE_ROOT` é…ç½®æ˜¯å¦æ­£ç¡®
2. æ˜¯å¦å·²ç»ä¸‹è½½äº†HTMLæ–‡ä»¶
3. äº¤æ˜“æ‰€/å…¬å¸åç§°æ˜¯å¦æ­£ç¡®

### Q2: éƒ¨åˆ†æ–‡ä»¶æœªé‡å†™

**A:** å¯èƒ½åŸå› ï¼š
1. ä¸‹è½½æ—¶å‡ºç°é”™è¯¯
2. å›¾ç‰‡ä¸‹è½½å¤±è´¥ï¼ŒHTMLæœªé‡å†™
3. æŸäº›å›¾ç‰‡ä½¿ç”¨äº†å¤–éƒ¨é“¾æ¥

### Q3: æµ‹è¯•é€Ÿåº¦å¾ˆæ…¢

**A:** ä½¿ç”¨æŠ½æ ·æµ‹è¯•ï¼š
```bash
python test_html_image_rewrite.py --sample 50
```

## ğŸ“ é€€å‡ºç 

- `0`: æµ‹è¯•é€šè¿‡ï¼Œæ‰€æœ‰å›¾ç‰‡é“¾æ¥å·²é‡å†™
- `1`: æµ‹è¯•å¤±è´¥ï¼Œå‘ç°æœªé‡å†™çš„é“¾æ¥

å¯ç”¨äºCI/CDæµç¨‹ï¼š

```bash
python test_html_image_rewrite.py --sample 100
if [ $? -eq 0 ]; then
    echo "âœ… æµ‹è¯•é€šè¿‡"
else
    echo "âŒ æµ‹è¯•å¤±è´¥"
    exit 1
fi
```

## ğŸ”— ç›¸å…³å·¥å…·

- `check_file_integrity.py`: æ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥
- `export_integrity_report.py`: ç”Ÿæˆå®Œæ•´æ€§æŠ¥å‘Š
- `services/downloader.py`: ä¸‹è½½æœåŠ¡ï¼ˆåŒ…å«URLé‡å†™é€»è¾‘ï¼‰

---

**æœ€åæ›´æ–°**: 2025-11-01  
**ç‰ˆæœ¬**: 1.0

